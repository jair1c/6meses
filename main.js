const passwordInput = document.getElementById("password");
const loginScreen = document.getElementById("login-screen");
const diary = document.getElementById("diary");
const entryContainer = document.getElementById("entry");
const extraMessage = document.getElementById("extra-message");
const navigationButtons = document.getElementById("navigation-buttons");
const revealButton = document.getElementById("reveal-button");
const prevBtn = document.getElementById("prev-btn");
const nextBtn = document.getElementById("next-btn");
const finalOptions = document.getElementById("final-options");

const correctPassword = "1201";
let attempts = 0;
let currentIndex = 0;
let messageRevealed = false;

// M√∫sica
const music = document.getElementById("bg-music");
const musicToggle = document.getElementById("music-toggle");
let isPlaying = false;

musicToggle.addEventListener("click", () => {
  if (!isPlaying) {
    music.play();
    musicToggle.textContent = "‚è∏Ô∏è";
    isPlaying = true;
  } else {
    music.pause();
    musicToggle.textContent = "üéµ";
    isPlaying = false;
  }
});

// Fondos por carta
const backgrounds = [
  "backgrounds/enero.jpg",
  "backgrounds/febrero.jpg",
  "backgrounds/marzo.jpg",
  "backgrounds/abril.jpg",
  "backgrounds/mayo.jpg",
  "backgrounds/junio.jpg",
  "backgrounds/final.jpg"
];

function updateBackground(index) {
  document.body.classList.add("dynamic-bg");
  document.body.style.backgroundImage = `url('${backgrounds[index]}')`;
}

// Cartas
const entries = [
  {
    title: "üìÖ Enero ‚Äì El Comienzo",
    text: `Mi amor bonito,
    
    A veces pienso en c√≥mo empez√≥ todo‚Ä¶ y sonr√≠o. Porque nunca lo planeamos. Comenzamos habl√°ndonos por trabajo, all√° por junio del a√±o pasado. T√∫ me escrib√≠as para que te apoyara con tus informes mensuales, y yo con gusto te apoyaba. Era algo pr√°ctico, sin vueltas‚Ä¶ hasta que lleg√≥ octubre. El 23 de octubre, para ser exacto.
    
    Ese d√≠a, entre mensajes y bromas, me hiciste una sobre el iPhone, y no sabes lo que marc√≥ ese momento en m√≠. Fue como si, sin querer, se abriera una ventana diferente entre nosotros. Ya no habl√°bamos solo de trabajo. Empezamos a hablarnos con m√°s confianza, con sonrisas entre l√≠neas, con esa chispa que nadie m√°s ve√≠a, pero que nosotros sent√≠amos crecer.
    
    En diciembre ya nos habl√°bamos con cari√±o, con ternura. Como si el coraz√≥n ya estuviera avisando lo que ven√≠a. Y entonces lleg√≥ esa noche inolvidable: aquella del 12 de enero.
    
    Ese d√≠a te vi por primera vez. Est√°bamos en el baile, con la m√∫sica, las luces y los nervios latiendo m√°s fuerte que nunca. Me acerqu√© a ti con el alma en la mano, y te ped√≠ estar juntos. Te regal√© una cadena con un corazoncito, pero lo que realmente te entregu√© fue mi decisi√≥n: la de elegirte, sin dudar.
    
    Te not√© nerviosa‚Ä¶ y eso me enterneci√≥ m√°s. Yo tambi√©n lo estaba, pero en ese instante todo tuvo sentido. Fue el inicio de algo que, desde entonces, no ha dejado de crecer.
    
    > ‚ÄúDesde que llegaste, las cosas simples comenzaron a sentirse m√°gicas.‚Äù ‚ú®
`
  },
  {
    title: "üìÖ Febrero ‚Äì Descubrirte",
    text: `Mi reina,
    
    Despu√©s de ese 12 de enero, todo empez√≥ a sentirse m√°s real, m√°s nuestro. Ya no solo √©ramos dos personas que se escrib√≠an bonito‚Ä¶ ahora est√°bamos empezando a vivir nuestra historia. Y febrero, con todo lo que representa el amor, fue como un escenario perfecto para seguir descubri√©ndote.
    
    ¬øSabes? Todav√≠a me acuerdo de la emoci√≥n con la que te prepar√© esa p√°gina web especial por San Valent√≠n. Quer√≠a darte algo diferente, algo que dijera "te quiero" sin necesidad de hablar. Lo hice pensando en lo que te gusta, en tu manera tranquila de sentir las cosas, y en c√≥mo pod√≠a hacerte sonre√≠r con un detalle sencillo pero hecho con el coraz√≥n.
    
    Y luego, en esos d√≠as de febrero, vino otro momento que guardo en mi memoria con ternura: cuando te entregu√© personalmente ese ramito tejido, con rosas y margaritas, y la tarjetita que te escrib√≠. Fue nuestra segunda vez vi√©ndonos‚Ä¶ ya sin tantos nervios, con m√°s tiempo para compartirnos aunque sea un poquito. Verte recibir ese detalle con dulzura me hizo sentir que iba por el camino correcto.
    
    Fue en ese mes donde supe que me estabas tocando de verdad. No era una ilusi√≥n‚Ä¶ eras t√∫.
    
    > ‚ÄúSupe que me gustabas de verdad‚Ä¶ cuando empec√© a pensar m√°s en ti que en m√≠.‚Äù üíå
`
  },
  {
    title: "üìÖ Marzo ‚Äì Admirarte",
    text: `Mi vida,
    
    Este mes no solo segu√≠ conoci√©ndote a ti‚Ä¶ sino tambi√©n a tu mundo. Ese mundo que tiene una personita tan especial como lo es Xioma. Cuando me contaste de ella, cuando me hablaste como mam√°, cuando vi tu dedicaci√≥n y ternura al cuidarla, algo dentro de m√≠ se acomod√≥ diferente.
    
    Te volviste a√∫n m√°s admirable.
    
    Y cuando se acerc√≥ su cumplea√±os y decid√≠ enviarte ese detalle con cari√±o, no fue por compromiso, ni por quedar bien. Fue porque quer√≠a estar presente en algo que s√© que es muy valioso para ti. Quer√≠a acompa√±arte en esa parte de tu vida, sin invadir, solo sumando, asi sea de a poquito.
    
    Ese mes aprend√≠ a valorar no solo a la mujer que me gusta, sino tambi√©n a la mam√° que eres. Entend√≠ que amar tambi√©n es aprender a cuidar lo que la otra persona ama.
    
    > ‚ÄúLa manera en que cuidas de Xioma me hizo admirarte a√∫n m√°s.‚Äù üåº`
  },
  {
    title: "üìÖ Abril ‚Äì Entenderte",
    text: `Amor,
    
    Abril fue un mes distinto. M√°s silencioso. M√°s introspectivo. Empezamos a sentir algunas diferencias‚Ä¶ no graves, pero s√≠ reales. Tus respuestas pausadas, tu forma tranquila de estar, me hac√≠an dudar a veces. Pero tambi√©n me ense√±aron mucho.
    
    Aprend√≠ que t√∫ no necesitas mostrar el amor como lo hago yo para que sea verdadero. T√∫ lo haces a tu manera. Y eso‚Ä¶ tambi√©n es valioso.
    
    Empec√© a dejar de buscar se√±ales externas y comenc√© a mirar m√°s profundo, a confiar m√°s en que tu presencia, aunque callada, tambi√©n es amor. Y con eso, fui cambiando yo tambi√©n: menos impulsivo, m√°s paciente, m√°s atento a tu ritmo.
    
    T√∫ no me empujas‚Ä¶ pero me invitas a ser mejor. Y eso es algo que no cualquiera logra.
    
    > ‚ÄúTal vez no me lo dices como yo, pero s√© que me quieres‚Ä¶ a tu manera.‚Äù üåô
`
  },
  {
    title: "üìÖ Mayo ‚Äì Expresarme",
    text: `Mi reina,
    Este mes me anim√© a expresarme de una manera diferente. Te escrib√≠ una carta a mano (La primera que hac√≠a para alguien)‚Ä¶ y te la entregu√© pensando en que, aunque no siempre sepa c√≥mo decirlo, mi amor por ti es constante.
    
    No lo hice para impresionarte, sino para que sintieras, sin presiones, lo que llevas causando en m√≠ desde hace tiempo. Y ese detalle no qued√≥ solo ah√≠‚Ä¶ segu√≠ envi√°ndote mensajes diarios, canciones que hablaban por m√≠, im√°genes con emoci√≥n, palabras que nac√≠an del d√≠a a d√≠a, sin gui√≥n.
    
    Tambi√©n comenc√© a respetar m√°s tus espacios. A entender que estar presente no es necesariamente hablar a cada rato, sino amar sin agobiar, dar sin esperar algo inmediato a cambio.
    
    Y t√∫, incluso en tus d√≠as m√°s calladitos‚Ä¶ segu√≠as ah√≠. Y eso, para m√≠, es suficiente para seguir.`
  },
  {
    title: "üìÖ Junio ‚Äì Abrazarte",
    text: `Mi Mar√≠a,
    Este mes fue m√°gico... Por fin te volv√≠ a ver. Despu√©s de tanto tiempo so√±ando con ese momento, al fin pudimos abrazarnos. Y no fue cualquier abrazo‚Ä¶ fue ese que sana, que confirma, que sostiene.
    
    Te mir√© a los ojos, escuch√© tu voz cerquita, sent√≠ tus manos‚Ä¶ y todo dentro de m√≠ se acomod√≥.
    
    Te juro que me llen√≥ el alma.
    
    Ese reencuentro no solo fue f√≠sico‚Ä¶ fue emocional. Me record√≥ por qu√© te eleg√≠. Me reafirm√≥ que lo que tenemos es real, que va m√°s all√° del tiempo, de los d√≠as buenos o dif√≠ciles. Me record√≥ que, aunque no siempre lo digamos todo, hay un amor firme sosteni√©ndonos.
    
    > ‚ÄúDespu√©s de todo, a√∫n me emociono como el primer d√≠a‚Ä¶ cuando me dices para vernos.‚Äù üíò
`
  },
  {
    title: "üíå Carta Final ‚Äì Seis meses contigo",
    text: `Mi amor, Mar√≠a:
    Hoy ya no estamos celebrando un mes m√°s‚Ä¶
    Hoy estamos celebrando medio a√±o caminando juntos.
    Seis meses desde que decidimos apostar por esto.
    Seis meses de mensajes, emociones, distancias, reencuentros, detalles y aprendizajes.
    Y si cierro los ojos y miro hacia atr√°s‚Ä¶ no hay un solo d√≠a en el que me arrepienta de haberte elegido.
    Este medio a√±o ha sido como una especie de diario vivo:
    lleno de p√°ginas inesperadas, de cap√≠tulos intensos, de silencios que tambi√©n hablaron, y de palabras que escrib√≠ con el coraz√≥n, a√∫n cuando t√∫ no me las ped√≠as.
    Desde aquel primer mensaje de trabajo, pasando por la broma del iPhone, hasta ese baile donde por fin nos vimos cara a cara‚Ä¶
    Todo ha ido tejiendo esta historia, la nuestra.
    Y si bien t√∫ y yo tenemos formas distintas de amar, siento que hemos sabido construir algo hermoso.
    T√∫ con tu calma, yo con mi intensidad.
    T√∫ con tu ritmo, yo con mis ideas locas.
    T√∫, que no necesitas decirlo todo para hacerlo sentir.
    Y yo, que a veces siento tanto que me desbordo sin querer.
    Pero aqu√≠ seguimos.
    Firmes. Presentes. Constantes.
    Porque amarte no es una carga, es una elecci√≥n.
    Y te elijo con lo que eres, con lo que a√∫n no has dicho, y con lo que solo t√∫ sabes mostrar cuando sientes seguridad.
    Este diario no termina hoy‚Ä¶
    Solo acaba de empezar otro cap√≠tulo.
    Gracias por estos seis meses.
    Gracias por ser t√∫.
    Gracias por dejarme amarte.
    
    Con amor,
    Tu Jair`
  }
];


// Login
function checkPassword() {
  const enteredPassword = passwordInput.value.trim();
  if (enteredPassword === correctPassword) {
  loginScreen.classList.add("hidden");

  const intro = document.getElementById("intro");
  intro.classList.remove("hidden");
  intro.classList.add("show");

  setTimeout(() => {
    intro.classList.remove("show");
    intro.classList.add("hidden");
    diary.classList.remove("hidden");
    showEntry(currentIndex);
  }, 3000); // duraci√≥n de intro (3 segundos)
} else {
    attempts++;
    const errorMsg = document.getElementById("error-msg");
    errorMsg.textContent =
      attempts >= 3
        ? "Ups‚Ä¶ parece que no es la fecha que guardamos en el coraz√≥n üòÖ"
        : "Contrase√±a incorrecta. Int√©ntalo de nuevo.";
  }
}

// Mostrar carta
function showEntry(index) {
  entryContainer.classList.remove("show");

  setTimeout(() => {
    const entry = entries[index];
    entryContainer.innerHTML = `
      <h2>${entry.title}</h2>
      <p>${entry.text.replace(/\n/g, "<br>")}</p>
    `;
    entryContainer.scrollTop = 0;
    entryContainer.classList.add("show");

    updateBackground(index);

    // Botones
    prevBtn.disabled = index === 0;
    nextBtn.textContent =
      index === entries.length - 2 ? "Carta final üíå" : "Carta siguiente ‚Üí";

    if (index === entries.length - 1) {
  navigationButtons.classList.add("hidden");
  finalOptions.classList.remove("hidden");
  entryContainer.classList.remove("hidden");
  extraMessage.classList.add("hidden");
  document.getElementById("gallery").classList.add("hidden");
} else {
  navigationButtons.classList.remove("hidden");
  finalOptions.classList.add("hidden");
  extraMessage.classList.add("hidden");
  document.getElementById("gallery").classList.add("hidden");
}

    if (!messageRevealed) {
      extraMessage.classList.add("hidden");
    }

  }, 200);
}

function nextEntry() {
  if (currentIndex < entries.length - 1) {
    currentIndex++;
    showEntry(currentIndex);
  }
}

function prevEntry() {
  if (currentIndex > 0) {
    currentIndex--;
    showEntry(currentIndex);
  }
}

function revealMessage() {
  entryContainer.classList.add("hidden");
  navigationButtons.classList.add("hidden");
  revealButton.classList.add("hidden");
  extraMessage.classList.remove("hidden");
  messageRevealed = true;
}

function resetDiary() {
  currentIndex = 0;
  extraMessage.classList.add("hidden");
  entryContainer.classList.remove("hidden");
  navigationButtons.classList.remove("hidden");
  showEntry(currentIndex);
}

function showMessage() {
  entryContainer.classList.add("hidden");
  document.getElementById("gallery").classList.add("hidden");
  finalOptions.classList.add("hidden");
  extraMessage.classList.remove("hidden");
  messageRevealed = true;
}

function showGallery() {
  entryContainer.classList.add("hidden");
  extraMessage.classList.add("hidden");
  finalOptions.classList.add("hidden");
  document.getElementById("gallery").classList.remove("hidden");
}

function backToFinalCard() {
  extraMessage.classList.add("hidden");
  document.getElementById("gallery").classList.add("hidden");
  entryContainer.classList.remove("hidden");
  finalOptions.classList.remove("hidden");
}

const canvas = document.getElementById("hearts-canvas");
const ctx = canvas.getContext("2d");

let width, height;
let hearts = [];

function resizeCanvas() {
  width = canvas.width = window.innerWidth;
  height = canvas.height = window.innerHeight;
}

function createHeart() {
  return {
    x: Math.random() * width,
    y: height + 10,
    size: 10 + Math.random() * 10,
    speed: 1 + Math.random() * 2,
    opacity: 0.5 + Math.random() * 0.5
  };
}

function drawHeart(heart) {
  ctx.save();
  ctx.globalAlpha = heart.opacity;
  ctx.fillStyle = "#ff6b81"; // color del coraz√≥n
  ctx.beginPath();
  const x = heart.x;
  const y = heart.y;
  const s = heart.size / 2;
  ctx.moveTo(x, y);
  ctx.bezierCurveTo(x + s, y - s, x + 2 * s, y + s / 1.5, x, y + 2 * s);
  ctx.bezierCurveTo(x - 2 * s, y + s / 1.5, x - s, y - s, x, y);
  ctx.fill();
  ctx.restore();
}

function updateHearts() {
  ctx.clearRect(0, 0, width, height);
  hearts.forEach((heart) => {
    heart.y -= heart.speed;
    drawHeart(heart);
  });
  hearts = hearts.filter((h) => h.y + h.size > 0);

  if (hearts.length < 30) {
    hearts.push(createHeart());
  }

  requestAnimationFrame(updateHearts);
}

window.addEventListener("resize", resizeCanvas);
resizeCanvas();
updateHearts();